<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.upedge.oms.modules.move.dao.OmsDataMoveDao">


    <select id="selectLastMonthPaymentId" resultType="com.upedge.oms.modules.move.entity.CustomerPaymentId">
        select DISTINCTROW payment_id as `paymentId`,
        customer_id as `customerId`,
        pay_time as `payTime`
        from ${table}
        where DATE_SUB(CURDATE(), INTERVAL 30 DAY) &lt;= pay_time
        and pay_state = '1'
        and order_type != '1'
    </select>

    <select id="selectOrderIds" resultType="java.lang.Long">
        select distinct order_id
        from order_item
        where admin_variant_weight is null
    </select>

    <select id="selectLastId" resultType="java.lang.Long">
        select id
        from ${table}
        order by `id` asc
        limit 1
    </select>

    <update id="complateStoreOrderRelate">
        update store_order_relate sor
        inner join store_order so
        on sor.store_order_id = so.id
        set sor.plat_order_name = so.plat_order_name,
        sor.financial_status = so.financial_status,
        sor.fulfillment_status = so.fulfillment_status,
        sor.plat_order_create_time = so.create_time,
        sor.store_name = so.store_name;

        update store_order_relate sor
        inner join `order` o
        on sor.order_id = o.id
        set sor.order_create_time = o.create_time;

        update store_order_relate sor
        inner join order_address oa
        on sor.order_id = oa.order_id
        set sor.order_customer_name = oa.name;

    </update>

    <update id="complatedStoreOrderItem">
        update store_order_item soi
        inner join store_order so
        on soi.store_order_id = so.id
        set soi.plat_order_id = so.plat_order_id;

        update order_item oi
        inner join admin_product_variant apv
        on oi.admin_variant_id = apv.id
        set oi.admin_variant_image = apv.variant_image,
        oi.admin_variant_sku = apv.variant_sku,
        oi.admin_variant_weight = apv.weight,
        oi.admin_variant_volume = apv.volume_weight,
        oi.cny_price = apv.variant_price;
    </update>


    <update id="complatedCarts">
        update cart oi
        inner join admin_product_variant apv
        on oi.variant_id = apv.id
        set oi.variant_image = apv.variant_image,
        oi.variant_sku = apv.variant_sku,
        oi.variant_weight = apv.weight,
        oi.variant_volume = apv.volume_weight,
		oi.variant_name = apv.variant_name;

		update cart c
		inner join admin_product_attribute apa
		on c.product_id = apa.product_id
		set c.product_title = apa.product_title;
    </update>

    <update id="completedWholesaleOrderItems">
        update wholesale_order_item oi
        inner join admin_product_variant apv
        on oi.admin_variant_id = apv.id
        set oi.admin_variant_image = apv.variant_image,
        oi.admin_variant_sku = apv.variant_sku,
        oi.admin_variant_weight = apv.weight,
        oi.admin_variant_volume = apv.volume_weight,
        cny_price = apv.variant_price,
        usd_rate = '6.3',
        oi.admin_variant_name = apv.variant_name;


        update wholesale_order_item c
        inner join admin_product_attribute apa
        on c.admin_product_id = apa.product_id
        set c.admin_product_title = apa.product_title;
    </update>

    <update id="complatedOrderRefundItem">
        update order_refund_item oi
        inner join order_item apv
        on oi.order_item_id = apv.id
        set oi.variant_image = apv.admin_variant_image,
        oi.variant_sku = apv.admin_variant_sku;
    </update>

    <update id="completedStockOrderItems">
        update stock_order_item oi
        inner join admin_product_variant apv
        on oi.variant_id = apv.id
        set oi.variant_image = apv.variant_image,
        oi.variant_sku = apv.variant_sku,
        oi.variant_name = apv.variant_name;


        update stock_order_item c
        inner join admin_product_attribute apa
        on c.product_id = apa.product_id
        set c.product_title = apa.product_title;
    </update>

    <update id="completedCustomerStockRecord">
        update customer_stock_record oi
        inner join admin_product_variant apv
        on oi.variant_id = apv.id
        set oi.variant_image = apv.variant_image,
        oi.variant_sku = apv.variant_sku,
        oi.variant_name = apv.variant_name;
    </update>

    <update id="completedStockRefundOrderItems">
        update stock_order_refund_item oi
        inner join admin_product_variant apv
        on oi.variant_id = apv.id
        set oi.variant_image = apv.variant_image,
        oi.variant_sku = apv.variant_sku,
        oi.variant_name = apv.variant_name;


        update stock_order_refund_item c
        inner join admin_product_attribute apa
        on c.product_id = apa.product_id
        set c.product_title = apa.product_title;
    </update>
    <update id="OrderAllUpdateSql">
                UPDATE `order`
        SET payment_id = id
        WHERE
            order_type != 1
            AND pay_state = 1
            AND id > 0
            AND ( payment_id IS NULL OR payment_id = '' OR  payment_id = 0);

                    UPDATE `wholesale_order`
                    SET payment_id = id
                    WHERE
                        order_type != 2
                        AND pay_state = 1
                        AND id > 0
                        AND ( payment_id IS NULL OR payment_id = ''  OR  payment_id = 0);

                                    UPDATE `stock_order`
                                    SET payment_id = id
                                    WHERE
                                        pay_state = 1
                                        AND id > 0
                                        AND ( payment_id IS NULL OR payment_id = ''  OR  payment_id = 0 );
    </update>

    <update id="completedCustomerProductStock">
        update customer_product_stock oi
        inner join admin_product_variant apv
        on oi.variant_id = apv.id
        set oi.variant_image = apv.variant_image,
        oi.variant_sku = apv.variant_sku,
        oi.variant_name = apv.variant_name;


				update customer_product_stock c
        inner join admin_product_attribute apa
        on c.product_id = apa.product_id
        set c.product_title = apa.product_title;
    </update>


</mapper>